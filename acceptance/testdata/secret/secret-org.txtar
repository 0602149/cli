# Prepare organization secret, GitHub Actions uppercases secret names
env2upper RANDOM_STRING ORG_SECRET_NAME

# Confirm organization secret does not exist, will fail admin:org scope missing
! exec gh api /orgs/$ORG/actions/secrets/$ORG_SECRET_NAME
stdout '"status":"404"'

# Create an organization secret
exec gh secret set $ORG_SECRET_NAME --org $ORG --body 'does not matter as cannot read it once set'

# Defer organization secret cleanup
defer gh secret delete $ORG_SECRET_NAME --org $ORG

# Confirm organization secret exists
exec gh secret list --org $ORG
stdout $ORG_SECRET_NAME
