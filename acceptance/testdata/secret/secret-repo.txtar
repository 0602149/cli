# Force GitHub CLI to treat testscript as TTY
env GH_FORCE_TTY=80
env REPO=$SCRIPT_NAME-$RANDOM_STRING

# Create a repository where the secret will be registered
exec gh repo create $ORG/$REPO --add-readme --private

# Defer repo cleanup
defer gh repo delete --yes $ORG/$REPO

# Clone the repo
exec gh repo clone $ORG/$REPO
cd $REPO

# Verify no repository secrets exist
exec gh secret list
stderr 'no secrets found'

# Create a repository secret
exec gh secret set TESTSCRIPTS --body 'does not matter as cannot read it once set'
stdout 'Set Actions secret TESTSCRIPTS for'

# Verify new repository secret exists
exec gh secret list
stdout 'TESTSCRIPTS\s+less than a minute ago'
