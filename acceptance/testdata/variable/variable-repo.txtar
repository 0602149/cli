# Setup environment variables to force TTY
env GH_FORCE_TTY=80
env REPO=$SCRIPT_NAME-$RANDOM_STRING

# Create a repository where the variable will be registered
exec gh repo create $ORG/$REPO --add-readme --private

# Defer repo cleanup
defer gh repo delete --yes $ORG/$REPO

# Clone the repo
exec gh repo clone $ORG/$REPO
cd $REPO

# Verify no repository variables exist
exec gh variable list
stderr 'no variables found'

# Create a repository variable
exec gh variable set TESTSCRIPTS --body 'just a repo variable'
stdout 'Created variable TESTSCRIPTS for'

# Verify new repository variable exists
exec gh variable list
stdout 'TESTSCRIPTS\s+just a repo variable\s+less than a minute ago'

# Verify repository variable can be retrieved
exec gh variable get TESTSCRIPTS
stdout 'just a repo variable'
